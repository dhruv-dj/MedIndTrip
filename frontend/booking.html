<!DOCTYPE html>
<head>
    <title>Appointment Booking | MedIndTrip</title>
    <meta charset="UTF-8">
    <meta name="description" content="Appointment Booking by MedIndTrip">
    <meta name="keywords" content="">
    <meta name="author" content="MedIndTrip">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="fontawesome.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="crossorigin="anonymous"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    
    
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">MED<strong>IND</strong>TRIP</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item ">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item active">
            <a class="nav-link" href="#">Book An Appointment</a>
            </li>
        </ul>
        </div>
    </nav>
    <div class="spacing"></div>
    <div class="container h-100">
        <div class="row">
            <div class="col-4"></div>
            <div class="col-4">
                <div class="icon-bar">
                  <a class="icon-active step1" href="#"><i class="fa fa-phone"></i></a>
                  <a class="step2" href="#"><i class="fa fa-star"></i></a>
                  <a class="step3" href="#"><i class="fa fa-hospital"></i></a>
                  <a class="step4" href="#"><i class="fa fa-user-md"></i></a>
                  <a class="step5" href="#"><i class="fa fa-check"></i></a>
                </div>
            </div>
        </div>
        <div class="spacing"></div>
        <!-- Step 1 | Contact Info -->
    <div id = "step1" class="row">
        <div class="col-3"></div>
        <div class="card col">
        <div class="card-body">
        <form>
          <div class="form-group">
            <label for="email">Email address</label>
            <input type="email" class="form-control" name="email" id="email" aria-describedby="emailHelp" placeholder="Enter email">

          </div>
          <div class="form-group">
            <label for="contact">Mobile Number</label>
            <input type="tel" class="form-control" name="phone" id="contact" placeholder="Enter Number">
          </div>
          <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="exampleCheck1">
            <label class="form-check-label" for="exampleCheck1">I agree to the Terms &amp; Conditions</label>
          </div>
          <button id="step1next" class="btn btn-primary">Next</button>
        </form>
        </div>
        </div>
        <div class="col-3"></div>
        </div> 
        <!-- Step 2 | Choose Specialization -->
    <div id = "step2" class="row">
        <div class="col-3"></div>
        <div class="card col">
        <div class="card-header text-center">
            <h5>Choose Specialization</h5>
        </div>    
        <div class="card-body">
            <form >
<!--
            <div class="row">
                <div class="col-4">
                    <input name="Cardiology" type="button" class="btn btn-block btn-outline-dark speciality-btn" value="Cardiology" />
                </div>
                <div class="col-4">
                    <input name="Oncology" type="button" class="btn btn-block btn-outline-dark speciality-btn" value="Oncology" />
                </div>
                <div class="col-4">
                    <input name="Pediatrics" type="button" class="btn btn-block btn-outline-dark speciality-btn" value="Pediatrics"/>
                </div>
                <div class="col-4">
                    <input name="ENT" type="button" class="btn btn-block btn-outline-dark speciality-btn" value="ENT"/>
                </div>
                <div class="col-4">
                    <input name="Gynaecology" type="button" class="btn btn-block btn-outline-dark speciality-btn" value="Gynaecology"/>
                </div>
                <div class="col-4">
                    <input name="Optics" type="button" class="btn btn-block btn-outline-dark speciality-btn" value="Optics"/>
                </div>  
            </div> 
-->
<!--            <div class="spacing"></div>-->
<!--            <div class="row">-->
<!--                <div class="col-6">-->
                    <div class="form-group">
                        <label for="specialization">Specialization</label>
                        <select name="Specialization" class="form-control" id="specialization">
                          <option>Select Specialization...</option>
                        </select>
                    </div>
<!--                </div>-->
<!--                <div class="col-6">-->
                        <div class="form-group">
                            <label for="sub-specialization">Sub Category</label>
                            <select name="SubSpecialization" class="form-control" id="sub-specialization">
                              <option>Select Sub Category...</option>
                              <option value="a">A</option>
                              <option value="b">B</option>
                              <option value="c">C</option>
                            </select>
                        </div>
<!--                </div>-->
<!--                </div>-->
            <div class="row justify-content-center">
                <div class=""><button id="step2next" class="center btn btn-outline-success">Proceed</button></div>
            </div>
        </form>
        </div>
        </div>
        <div class="col-3"></div>
        </div>
        <!-- Step 3 | Choose Hospital -->
    <div id = "step3" class="row">
        <div class="col-3"></div>
        <div class="card col">
        <div class="card-body">
        <form>
          <div class="form-group">
            <label for="date">Select Appointment Date</label>
            <input id="appointmentDate" class="form-control" type="date" name="Date" >
          </div>
          <div class="form-group">
            <label for="date">Choose Hospital</label>
            <select name="Hospital" class="form-control" id="hospital">
              <option>Click to select hospital...</option>
              <option value="Max">Max</option>
              <option value="Apollo">Apollo</option>
              <option value="BLK">BLK</option>
            </select>
          </div>
          
          <button id="step3next" class="btn btn-primary">Next</button>
        </form>
        </div>
        </div>
        <div class="col-3"></div>
    </div> 
        <!-- Step 4 | Choose Doctor -->
    <div id = "step4" class="row">
        <div id = "doctor-list" class="card-deck">
            <div class="card mb-3" style="max-width: 540px;">
              <div class="row no-gutters">
<!--
                <div class="col-md-4">
                  <img src="images/docimage.jpg" class="card-img" alt="...">
                </div>
-->
                <div class="col-md-8">
                  <div class="card-body">
                    <h5 class="card-title">Dr. Drake Ramoray</h5>
                    <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                    <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                    <form class="form-inline">
                    <select name="slot" class="form-control" id="docName1slot">
                      <option>Click to select slot...</option>
                      <option value="1000">10:00</option>
                      <option value="1015">10:15</option>
                      <option value="1030">10:30</option>
                    </select> &nbsp;   
                    <input id="docName1" type="button" class="btn btn-outline-dark doc" value="Book"/>
                    </form>    
                  </div>
                </div>
              </div>
            </div>
            <div class="card mb-3" style="max-width: 540px;">
              <div class="row no-gutters">
                <div class="col-md-4">
                  <img src="images/docimage.jpg" class="card-img" alt="...">
                </div>
                <div class="col-md-8">
                  <div class="card-body">
                    <h5 class="card-title">Dr. Drake Ramoray</h5>
                    <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                    <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                    <form class="form-inline">
                    <select name="slot" class="form-control" id="docName2slot">
                      <option>Click to select slot...</option>
                      <option value="1200">12:00</option>
                      <option value="1215">12:15</option>
                      <option value="1230">12:30</option>
                    </select> &nbsp;   
                    <input id="docName2" type="button" class="btn btn-outline-dark doc" value="Book"/>
                    </form>    
                  </div>
                </div>
              </div>
            </div>
        </div>
    </div>
        <!-- Step 5 | Confirmation -->
    <div id = "step5" class="row">
        <div class="col-3"></div>
        <div class="card col">
        <div class="card-body">
        <form>
          <div class="form-group">
            <label for="fname">First Name</label>
            <input type="text" class="form-control" name="fname" id="fname" aria-describedby="firstName" placeholder="Enter First Name">
          </div>
          <div class="form-group">
            <label for="lname">Last Name</label>
            <input type="text" class="form-control" name="lname" id="lname" placeholder="Enter Last Name">
          </div>
          <div class="form-group">
            <label for="age">Age</label>
            <input type="number" class="form-control" name="age" id="age" placeholder="Enter Age">
          </div> 
          <div class="form-group">
            <label for="gender">Gender</label>
            <select name="gender" class="form-control" id="gender">
              <option>Click to select gender...</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
          </div>     
          <button id="book" class="btn btn-primary">Confirm Booking</button>
        </form>
        </div>
        </div>
        <div class="col-3"></div>
    </div>
    </div>
    <div class="spacing"></div>
    <footer class="text-center">MedIndTrip&copy;2019</footer>
</body>

<script>
    var docData = 0;
    $.ajax({
          url:'/getDoctors',
          type:'GET',
          success: function(data){
              docData = data;
//              console.log(docData);
          }
      })
    var hospData = 0;
    $.ajax({
          url:'/getHospitals',
          type:'GET',
          success: function(data){
              hospData = data;
//              console.log(hospData);
          }
      })
    var specializationData = 0;
    $.ajax({
          url:'/getspeciality',
          type:'GET',
          success: function(data){
              specializationData = data;
              console.log(specializationData);
              var str="";
              for(var i in specializationData){
                  str+=`<option value="${specializationData[i].name}">${specializationData[i].name}</option>`;
              }
              $("#specialization").append(str);
          }
      })

$(document).ready(function(){
    $("#step2").hide();
    $("#step3").hide();
    $("#step5").hide();
    $("#step4").hide();
    $("#step1").show();
    
    
});
    var jsonData = new Object();    
    $("#step1next").click(function(e){
        e.preventDefault();
        jsonData['mobile'] = $('#contact').val();
        jsonData['email'] = $('#email').val();
  $("#step1").hide("fast");
  $("#step2").show("fast"); 
  $("a.step1").removeClass("icon-active");
  $("a.step2").addClass("icon-active");
  });
    
    $("#step2next").click(function(e){
        e.preventDefault();
        var specialization = $('#specialization').val();
        jsonData['specialization'] = specialization;
        jsonData['sub-specialization'] = $('#sub-specialization').val();
        var str="<option>Click to select hospital...</option>";
        $("#hospital").empty();
        for(var i=0;i<docData.length;i++){
            if(docData[i].Specialization == specialization){
                str += "<option value=" + docData[i].Hospital.id + ">" +docData[i].Hospital.Name +"</option>";
            }
        }
        $("#hospital").append(`${str}`);
  $("#step2").hide("fast");
  $("#step3").show("fast");
  $("a.step2").removeClass("icon-active");
  $("a.step3").addClass("icon-active");
  });
    
    $("#step3next").click(function(e){
        e.preventDefault();
        var hospitalID = $("#hospital").val();
        jsonData['hospital'] = hospitalID;
        jsonData['date'] = $("#appointmentDate").val()
        for(var i=0;i<docData.length;i++){
            var str = "";
            if(docData[i].Specialization == jsonData.specialization&&docData[i].Hospital.id==hospitalID){
                slots="";
                for(var j=0;j<docData[i].Slots.length;j++){
                    slots+=`<option value="${docData[i].Slots[j]}">${docData[i].Slots[j]}</option>`;
                }
                str += `<div class="card mb-3" style="max-width: 540px;">
              <div class="row no-gutters">
                <div class="col-md-4">
                  <img src="${docData[i].PhotoPath}" class="card-img" alt="...">
                </div>
                <div class="col-md-8">
                  <div class="card-body">
                    <h5 class="card-title">${docData[i].Name}</h5>
                    <p class="card-text">${docData[i].Degree} | ${docData[i].Experience}</p>
                    <p class="card-text"><small class="text-muted">${docData[i].Specialization}</small></p>
                    <form class="form-inline">
                    <select name="slot" class="form-control" id="${docData[i]._id}slot">
                      <option>Click to select slot...</option>
                      ${slots}
                    </select> &nbsp;   
                    <input id="${docData[i]._id}" type="button" class="btn btn-outline-dark doc" value="Book"/>
                    </form>    
                  </div>
                </div>
              </div>
            </div>`;
            $("#doctor-list").append(`${str}`);
//            var slotStr = "";
//            for(var j=0;j<docData[i].)
            }
        }
        
        console.log(jsonData);
          $("#step3").hide("fast");
          $("#step4").show("fast");
          $("a.step3").removeClass("icon-active");
          $("a.step4").addClass("icon-active");

    });

    
//    $(".doc").click(function(e){
//       e.preventDefault();
//       var docID = this.id;
//        var slotID = '#'+docID+'slot';
//        var slotVal = $(slotID).val();
////        console.log(slotVal);
//        jsonData['doctor'] = docID;
//        jsonData['slot'] = slotVal;
//        $("#step4").hide("fast");
//  $("#step5").show("fast"); 
//  $("a.step4").removeClass("icon-active");
//  $("a.step5").addClass("icon-active");
//    });
    
$(document).on("click", ".doc", function(e){
      e.preventDefault();
       var docID = this.id;
        var slotID = '#'+docID+'slot';
        var slotVal = $(slotID).val();
        console.log(slotID);
        console.log(slotVal);
        jsonData['doctor'] = docID;
        jsonData['slot'] = slotVal;
        $("#step4").hide("fast");
  $("#step5").show("fast"); 
  $("a.step4").removeClass("icon-active");
  $("a.step5").addClass("icon-active");
    });
    
$("#book").click(function(e){
        e.preventDefault();
        jsonData['name'] = $("#fname").val() +" "+ $("#lname").val();
        jsonData['age'] = $("#age").val();
        jsonData['gender'] = $("#gender").val();
        console.log(jsonData);
        
        $.ajax({
            url: '/confirmBooking',
            type: 'POST',
            data: JSON.stringify(jsonData),
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            async: false,
            done: function(msg) {
                console.log("Booking Successful");
            }
        });
    });
$("#specialization").change(function(){
    $("#sub-specialization").empty();
    
    var specialization = $(this).val();
//    console.log(specialization);
    var str = "";
    for(var i in specializationData){
//        console.log(specializationData[i]);
        if(specializationData[i].name==specialization){
//            console.log("x" + specialization);
            for(var j in specializationData[i].subspeciality){
                str+=`<option value="${specializationData[i].subspeciality[j]}">${specializationData[i].subspeciality[j]}</option>`;
            }
        }
    }
    $("#sub-specialization").append(str);
});
</script>

